//
// Created by younghoon on 23. 1. 28.
//

#ifndef DLGO_ZOBRIST_H
#define DLGO_ZOBRIST_H
#include <chrono>
#include <cstdint>
#include <iostream>
#include <random>

#include "gotypes.h"

namespace zobrist {
typedef struct ZobHash {
    int row;
    int col;
    gotypes::Player player;
    uint64_t code;

    ZobHash(int row, int col, gotypes::Player player, uint64_t code)
        : row(row), col(col), player(player), code(code) {}

    friend std::ostream& operator<<(std::ostream& os, const ZobHash& zobHash) {
        os << "(" << zobHash.row << "," << zobHash.col << ","
           << (zobHash.player == gotypes::Player::black ? "black" : "white")
           << "):\t" << zobHash.code;
        return os;
    };
} ZobHash;

inline std::vector<ZobHash> makeHash() {
    std::mt19937_64::result_type seed =
        std::random_device()() ^
        std::chrono::duration_cast<std::chrono::seconds>(
            std::chrono::system_clock::now().time_since_epoch())
            .count() ^
        std::chrono::duration_cast<std::chrono::microseconds>(
            std::chrono::high_resolution_clock::now().time_since_epoch())
            .count();
    auto rng = std::mt19937_64(seed);

    uint64_t MAX63 = 0x7fff'ffff'ffff'ffff;
    std::set<uint64_t> code_cache;
    std::vector<ZobHash> codes;

    for (auto row = 1; row < 20; row++) {
        for (auto col = 1; col < 20; col++) {
            for (auto s : gotypes::iterColors) {
                auto code = rng() % MAX63;
                while (code_cache.find(code) != code_cache.end())
                    code = rng() % MAX63;
                codes.emplace_back(row, col, s, code);
            }
        }
    }
    return codes;
}

inline void writeAsVec(const std::vector<ZobHash>& vec) {
    std::cout << "std::vector<uint64_t> _zob{" << '\n';
    for (const auto& z : vec)
        std::cout << z.code << ",\n";
    std::cout << "}" << '\n';
}

constexpr std::array<uint64_t, 19 * 19 * 2> _zob = {
    5508080386894766357, 8368948234247036331, 4450336772230782737,
    3455494197660444159, 8310653010049938271, 6399734728333484759,
    3572319172747591399, 8582247701078513987, 3248565811363886549,
    8777775997182142891, 6163274409933042002, 5479493755101236190,
    4120975147134267179, 4674731505172914827, 783050602555183198,
    84585611351241206,   7928709597307030468, 2855450973660382682,
    4929512052925774320, 7295454933754680,    2737696516272931795,
    3417516416004219454, 6388908830894215253, 4936911379769563446,
    4607290177043146996, 8078101766947608463, 3031573869845283779,
    5397803859500606784, 6990247506923686378, 8761433565293302146,
    5682459016508970256, 4026965877675728039, 3947037423042320096,
    5619669973714181404, 1689203130980054225, 4026862835303075353,
    8019958014429076576, 1181043497222209111, 8582968879192752252,
    299574025066758285,  324706642993541619,  4852269116860046291,
    6084131300557602761, 4937199211495568570, 2910436019021854152,
    7245830904169293294, 5982756584196645944, 8283404572231711572,
    2586057043164614689, 8386962057019791552, 4566678364415370634,
    8444137593804991057, 4912261083839476686, 6523046993296737422,
    115234750831184549,  2390598433576548564, 3613600096094179371,
    5256951508012688093, 6510999308012565804, 4136600199955955156,
    3465837350217977578, 5223352929451710440, 2831462597931406178,
    4613006935416776712, 4299597614865351715, 1694505986560692422,
    8775223564255618199, 651548242523003273,  2535652251134143410,
    4404332483508083034, 2098413899360892670, 5308528918786142312,
    561982376112055064,  3902872994976237156, 7308674860992051958,
    7166456673509870494, 1361270941673610069, 5179072938587624280,
    4340838414569911906, 3318199943216422410, 3481434072711876851,
    1574338809201967367, 2806220243399573188, 1468290587583695999,
    2106113510608053619, 2229014244819974196, 1083092478385572424,
    8166724721426394532, 5788814064804051496, 3391981937052827831,
    7742364295020799038, 1835349474358977104, 6083652401275422814,
    5825868702165841854, 7067113986167049342, 2257152545316142575,
    5365447972705981454, 9083941907549435480, 5151433156230893197,
    8973932660847195819, 4400953371700321537, 2425941259968886371,
    6789358593115975188, 4248827782944257004, 7360288905898951837,
    6892097412866572638, 6813307882238509340, 1753945918614610134,
    5569223872042094270, 8867980459952263087, 641277128914066567,
    1170210325246823396, 1438919893946987013, 3593507618962350814,
    6514597670416669079, 2709928153504756470, 6243817975871535403,
    563407711188989493,  7865900555076284446, 5180569964616866599,
    2620294794191667213, 1712672917798706098, 7471133590051160788,
    7261175869355633350, 9046050581929237663, 3002508212092862860,
    1330468930100659629, 2742520287574656535, 1249112481750766011,
    9016961335864000916, 880778380729849081,  8441833495944374183,
    116940660494214292,  8576595669830629062, 3357374116938690403,
    5484886162269641189, 8308252238330424822, 1320969151113949778,
    8227851135005095665, 8250923601475228910, 3485928575460506435,
    1235088215708492367, 3181224582908336140, 5108983699730131338,
    6550491594254044078, 360988958977992767,  8909975754296492299,
    833252509581745385,  8635885411886382003, 2739917944689226000,
    4237331979385722632, 7922578859438483028, 1403996600610515242,
    7082974997546337954, 223082377324721714,  5074749188486738644,
    6252506890115610029, 539457024420695418,  2470721085903152547,
    812418135882151046,  1739508369865620303, 1193530303690990676,
    3286215295821171502, 1863902590174112123, 1526678267156568628,
    5738208908144036742, 819973139976496676,  6957872493606278769,
    6722708844482185714, 233065192174171634,  7374534249717734350,
    3604622069636614885, 2030024324608607002, 4367774020636990328,
    7624444312376667604, 8047615930033334011, 1871575959196330964,
    1751547426780002212, 4774957398564233618, 8445614722379746826,
    8808172330133957403, 2086171259026046562, 871341392527938553,
    6253157282369098307, 765869971455362135,  7190236074843070754,
    6625952686953198927, 1475923579025091571, 5809164080688823882,
    8845439528598771282, 560243534955385774,  8082202797911656482,
    5603438508510856887, 2941750682904391211, 4879416347301229379,
    5769353277729877282, 4194982069653675383, 8094359500192387644,
    10888849540392907,   6736491316080734270, 3337643898621700453,
    3069041020561961045, 5656978510178980360, 3793787280309832424,
    3854251303846629310, 8298707361964844681, 3250612790924552486,
    5762554475888772930, 9182601622745055101, 2633446248151784581,
    7029007321096260328, 1706215939765878337, 1554590072439051351,
    5044960384185832695, 2183139400857467487, 3193315448415460179,
    4494126375503469398, 3682134183666163980, 5448760300578394555,
    5188805361232859883, 4658109290661288797, 4234632739372423904,
    5834095558067555709, 8968856036167999272, 3127804735859297326,
    8444145389835600375, 2592551455640560187, 4261201564915319118,
    1433735290278378147, 6852101637781208374, 7293344993551648502,
    3246497139531107080, 9110917546783229381, 5469903619755444388,
    691242681525584757,  1472938156601731421, 611869487774408491,
    496830047995464139,  7060547767254360911, 856422022336314011,
    8750051990446892764, 1266322432609788143, 493467179363189046,
    7867134794942243578, 944049846087387302,  1280019981976689551,
    7233756523216410033, 4999485576280714432, 6420624579542022166,
    8623010788651577107, 7491146414879159705, 4284955524224564086,
    3293913724796446851, 8327592502372212348, 6577019937199537787,
    2035888456174259200, 2935085665669803363, 3495847874373593591,
    6068584362896849339, 1891507587093578461, 7411679829572795738,
    5708800628735587279, 907879317225381783,  188488116871352929,
    7250157098252466760, 5494973082585612215, 8992735472198224335,
    3666856604304216364, 4010389315543653489, 8321968397812066308,
    6890792773608422589, 1647027054666984664, 8855107721541226905,
    4835806683278775891, 7014543212581575009, 4077212183953521998,
    1989300541541482632, 4020957879989248863, 2940704751654881202,
    1530677058236492119, 908522893827992068,  5638315460013200324,
    958326814501513062,  119711214925959305,  3201097823363453601,
    5634539083626975142, 3766250630091782553, 1139179198786149981,
    6600881311592472420, 8631093448765470450, 7701571687517207827,
    4210780252651471896, 2147820690043094379, 1360720460889356047,
    8331256324830193189, 5335702332403665956, 8493914729886077998,
    5238558769360087465, 5957756080029805104, 3842804816016412014,
    1327701797850651838, 1713709520171050901, 1607251222421155838,
    3567324849253018587, 5966708521415498243, 1365958964929506921,
    3145479982508690300, 897878556584806315,  6003858432744278464,
    1370874506172490003, 1251954534224913975, 7531685899439718298,
    6630879191836103993, 2109854810941187818, 9079233856540767095,
    1548042186491517449, 6787799261672658573, 6133037063258922353,
    8984469791711810112, 1627230866198974832, 7207888960646901987,
    3813850519587931383, 8733485994076998476, 8509286808033228579,
    4012167393565183175, 7513348939953593353, 7049308519353302897,
    4846132828050332911, 8639380621808168393, 306520812064820410,
    3304610258727631787, 6000906242310217269, 7270240129220517343,
    5451822909608210757, 8844356582157011441, 6980544111700365515,
    3384682571514073249, 8805633692327475360, 9099344966899736292,
    3657443030016839228, 2674463831084090652, 5288398305124315208,
    7508728757565033420, 3837621716433351746, 4953640583621661372,
    3952295403037034878, 3399331074510895526, 324025615663150378,
    4593668391872317328, 7383584417648589148, 1758963362861576957,
    2584363429442286678, 898041661675785984,  3907000947008457007,
    1477564186318364907, 5542780313673851659, 2951516421687471887,
    4641732880794052962, 7716888800943535669, 679999031502443717,
    1917961884195567594, 3546670285130014901, 3732501783938458350,
    2946625169939768665, 5815018024601084525, 5731739021103575198,
    4700406325265526436, 2861146815850913428, 7279509420969834106,
    4758610980384541861, 716062918931409636,  504158487406072166,
    8482370491272578228, 7826190361337923474, 1751539072004766278,
    8087312730749949712, 1022424958294381192, 3953179792743582790,
    1990056285623889802, 3697796134670875107, 7519573275186844606,
    8602444272717007950, 276974921837598640,  2445150620762703715,
    7919252437302155176, 7808601516679065951, 491426222912104609,
    9113924544090646830, 8338063024029978766, 6983007984325653965,
    6288193442433868707, 3757776777735150442, 4352581351642404584,
    3217452247191579685, 327109894508820729,  6474463857395889316,
    4857280106982435247, 6325182260808508604, 4699524805684514003,
    4148510401196935499, 5478323451305581912, 2857438062386392564,
    5379919770546011042, 8527341029918746711, 7885083480460019350,
    380297003757120349,  3637516909332919014, 5146490528187669818,
    3580911642495981044, 5786015077511543170, 1590423758866823714,
    8488678208551881250, 4426702742354928989, 3928300891154836908,
    3504949291325198842, 4542828036919098780, 3567507216295762745,
    6406315311017630766, 8800737830538869534, 8405583459725270730,
    6349122735794275504, 174895712132255932,  5954909988010822239,
    3045461722023367520, 2281747787270235775, 6949243078306365087,
    8529205169549973344, 1897360956268348717, 589313170026364535,
    4492106931734607595, 3856392966883324946, 8601058021378893961,
    1163022898066966945, 1993942258827674093, 6104913897164538868,
    2517481593488117388, 8375962533995199687, 604230854862616761,
    2046497866181129936, 2968763370914191353, 8216388100440867604,
    7195263586083324091, 7749508320587166014, 3505174512998755216,
    3050272939588652780, 7603825030978288576, 5523191902694346317,
    8848128675247682963, 8598630566644265225, 1613128071808377565,
    5086877227936167630, 1516702036440279268, 2965487627523353356,
    4182894198635650763, 9092194795965990788, 1475639069418308748,
    2661474991734870695, 7858823050204559382, 2191156944062590340,
    5561719608875668505, 7222942358209992312, 2173021871782901798,
    82997598125389105,   8664151164831143515, 2491494310698722850,
    2644495480623332828, 4712783988936637900, 8777099540620067919,
    5995461113007445763, 8945293920043298199, 8553386809152461712,
    2005746668175516319, 8384997752849471674, 7486416001151034831,
    3429909300220459955, 3279205164547546708, 6541540837958497977,
    7967596275583694038, 2884535071077573785, 1594592131888117156,
    6651550091479580201, 3352630356472616621, 1125256400492911686,
    3501678737165536455, 7327151980859901704, 7020529435565955741,
    1101069347793264893, 1009858782180613887, 7520990948008870635,
    6991164642487218405, 7494272693054212718, 3613316857617948659,
    2804086759551712057, 4626417891035007521, 7122931209350608139,
    7251445875346457872, 3950359535735896750, 8117700072086623143,
    8871905190769092706, 7672425324307168744, 4366356394378667915,
    4940543177715395102, 5856301438487585122, 138389854064015969,
    1342419529365909598, 8737485011976321984, 8987469416686946350,
    1656220556597436990, 6880269278811539969, 4728606296946225502,
    4758576899927590675, 5034987223429517572, 3710817596997108880,
    7673838335254814683, 311894036355456948,  1506153036117144005,
    8718726659494455979, 1247105584946606551, 2500345935979904232,
    5099992961264529290, 7950278090671138870, 2250058078048649406,
    5798396612466360931, 1090108721167307939, 3426778798469778312,
    9136765453171292120, 5851529311614340077, 1793524510565326319,
    624277079702518716,  7005513505333787466, 4817550911912464894,
    6546132437330600173, 1447930177413025950, 5917941052550946900,
    745718879874725453,  3904049813288899703, 2763749496940683961,
    7235360184051040832, 8107203646214010243, 632708898776069099,
    659276983465321864,  4681645427047409157, 798464437276591914,
    1354509148958672350, 4587434506699089410, 7391861455499858054,
    8119675556387276692, 6861531885601980652, 1478071294803348569,
    5308206498200951250, 8106983618334935620, 8065107661036822516,
    6775783135392832760, 7463401594289924912, 5832948451174078606,
    8710975943622798408, 979495851035501623,  7490006281993021994,
    1736073696277328728, 8703103266468452921, 8819527336857643701,
    5944998315136288096, 3042444107606566514, 209952950463405160,
    7750615162449340020, 7181848126390595228, 4300703134012475391,
    2429155498036700130, 6030279753933844452, 6225635400763455066,
    3478976720274635682, 1507650572195783967, 91457409808672774,
    2047079933529094797, 636549006800212919,  4101222384412755497,
    1891402448651253846, 1549265949781407011, 7128259882802234490,
    7355887849520393756, 5047278643076962014, 8433009683039499086,
    6689409303084658538, 1646142656569427424, 1144921536794711906,
    5748988291863804342, 8592266169757506021, 6687458496231343137,
    4488457385406721250, 464012167763040777,  934266476817488240,
    327580774095986581,  3507236438462102797, 3991679798994682517,
    8203096982125709911, 4425951280827363897, 3927146979091316681,
    1488978909337134712, 7631942015840854802, 5887614063105378495,
    4438270213655747917, 813216482659863474,  3260009824599433210,
    1991738139892942592, 4818259596896657848, 6350447794149944093,
    4496171904705588457, 5953180815444240779, 4119658475409784188,
    2086264941339666776, 5197433973461852301, 619985256906922719,
    1335269089698930869, 6280331694052793200, 3132910164941254702,
    3449252220196756352, 4270640885327135683, 3614794863618628170,
    7053696526163861576, 8520647508526609673, 100705292234149246,
    1741643712167707072, 367712349732217117,  5172695688805789790,
    4508689682819702287, 1315761950059707772, 9160500685017779106,
    2554619246466963609, 3469054853099630508, 1221525525481023401,
    406699335767572269,  2473800282955396182, 507949890230367364,
    4205184732633357674, 9180571087881910818, 7192444222026014857,
    3728149514187756733, 4698468231796518822, 3865848651397353067,
    857302201236780408,  4742582408483731068, 4624723486204370027,
    1201587887188592203, 5106505583863845498, 6670161412427225768,
    7845358938964447992, 5566041043980296389, 1830025596811475470,
    9175394346551063850, 8738429444588045748, 2827304738421011984,
    846982758010226603,  3478888893062184422, 1801656508057507914,
    515390004249451364,  7571154570556602075, 5452725498046470064,
    8593236809994143416, 245795770061600156,  5868795101399901694,
    2931275165923723558, 9122558848526955964, 9051236400787443834,
    7430016049416049023, 7945785572993396922, 3989355087773697085,
    9010387007856785207, 5961424794388592801, 2893157328101409878,
    8483934813269747244, 4097774132901498887, 5997976884724921911,
    3709897876167316738, 2802957656079008099, 2612072894127979668,
    1205357426352396951, 5294287115714490447, 7501063016976778443,
    4416197862650271119, 4896993187340005456, 3926868032545885816,
    1800519452278967937, 5043360269045219271, 5509403874701693568,
    1221882012754028045, 9047917930726417618, 5184157451412873453,
    5943142729794139948, 2433048881878388477, 7332215604869968328,
    4521099424863673594, 3586898938241509491, 3781208753602577116,
    6466097129397054326, 3520374509995475217, 8406741719306113987,
    1351793433509315584, 1833486916751435055, 7870440758904310248,
    2513908996138941665, 6794520713389448141, 499607270704512770,
    7433711409411358976, 4881757587310120762, 1496844828084648919,
    2933669953303310979, 4501448238788898778, 5754578504782209484,
    5941576997183376679, 2359749205474185878, 3677702677198291593,
    5025374546721583431, 4036938185378064250, 6846974453243923377,
    1658143482533360149, 1138257565278110947, 6284980420638179041,
    6443220464663984050, 9154048537294482247, 4046638950270788687,
    7233487246517218865, 4118200690475718758,
};

inline uint64_t get(int row, int col, gotypes::Player player) {
    return _zob[(row - 1) * 19 + (col - 1) +
                (player == gotypes::Player::black ? 0 : 1)];
}

constexpr std::uint64_t EMPTY_BOARD = 0;

}  // namespace zobrist
#endif  //DLGO_ZOBRIST_H