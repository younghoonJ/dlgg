//
// Created by younghoon on 23. 1. 28.
//

#ifndef DLGO_ZOBRIST_H
#define DLGO_ZOBRIST_H
#include <chrono>
#include <cstdint>
#include <iostream>
#include <random>

#include "gotypes.h"

namespace zobrist {
typedef struct ZobHash {
    int row;
    int col;
    gotypes::Player player;
    uint64_t code;

    ZobHash(int row, int col, gotypes::Player player, uint64_t code)
        : row(row), col(col), player(player), code(code) {}

    friend std::ostream& operator<<(std::ostream& os, const ZobHash& zobHash) {
        os << "(" << zobHash.row << "," << zobHash.col << ","
           << (zobHash.player == gotypes::Player::black ? "black" : "white")
           << "):\t" << zobHash.code;
        return os;
    };
} ZobHash;

inline std::vector<ZobHash> makeHash() {
    std::mt19937_64::result_type seed =
        std::random_device()() ^
        std::chrono::duration_cast<std::chrono::seconds>(
            std::chrono::system_clock::now().time_since_epoch())
            .count() ^
        std::chrono::duration_cast<std::chrono::microseconds>(
            std::chrono::high_resolution_clock::now().time_since_epoch())
            .count();
    auto rng = std::mt19937_64(seed);

    uint64_t MAX63 = 0x7fff'ffff'ffff'ffff;
    std::set<uint64_t> code_cache;
    std::vector<ZobHash> codes;

    for (auto row = 0; row < 20; row++) {
        for (auto col = 0; col < 20; col++) {
            for (auto s : gotypes::iterColors) {
                auto code = rng() % MAX63;
                while (code_cache.find(code) != code_cache.end())
                    code = rng() % MAX63;
                codes.emplace_back(row, col, s, code);
            }
        }
    }
    return codes;
}

inline void writeAsVec(const std::vector<ZobHash>& vec) {
    std::cout << "std::vector<uint64_t> _zob{" << '\n';
    for (const auto& z : vec)
        std::cout << z.code << ",\n";
    std::cout << "}" << '\n';
}

constexpr std::array<uint64_t, 20 * 20 * 2> _zob = {
    4343952251526534745, 5220579886841544209, 3269153299179879487,
    3298101680437601337, 1097928567561509113, 4684578788444455467,
    7395015354293436420, 2252341071519337382, 5787978976275247872,
    2596475725820771803, 659466075321301562,  3752835592413421641,
    2210028820027918284, 1279508291767189497, 4873347381687160866,
    7200239536092860748, 5708941619709699929, 2396180144144114604,
    4336502182357563640, 7343078480263556982, 7863906242876593488,
    2221225363019981175, 7324877740675647024, 7861107267764324792,
    8132806232046702981, 4543316823256159492, 4618139815491257182,
    7364590088235734971, 4216072232994467881, 5537136465554825720,
    8965262029388075392, 7262979894817453390, 4211638860349978827,
    3041328443927106674, 1270260009885740449, 4776576393939657241,
    8154352565328338672, 5909558648992278916, 9104456838953629139,
    1772475779489274057, 3424518817032478187, 8451852677449743690,
    7153104741582729177, 4863688966748999959, 9108743388421629199,
    8830636040602812306, 3542160648414794383, 4443786663865571847,
    1747661420293987053, 8667820516774056711, 4340354836104033514,
    28867169775477587,   3583479459625565899, 6587205715254671920,
    4660541593339548431, 941642287504999584,  828988902637283164,
    2999746723548968917, 826371696097725003,  6306483764920783845,
    3627450861853332231, 1893705017187366654, 2460455913074129817,
    4010810331812822092, 7802200733332535321, 5390992357584005164,
    4538714805145023072, 5749527283690380888, 7911239267580970820,
    2230217438207006282, 6330294665432799478, 5926883278558198183,
    3976824575630266728, 8215221404404766784, 6673246880416268760,
    2926563413548683868, 185346163710689109,  3340946488219311481,
    625617012006766128,  2750394291035546132, 6354419123960392476,
    4471235075376409436, 1171564404559013479, 2924998578353572770,
    2398164688730479743, 1281193591473469322, 2594134918709926704,
    7657104122525959679, 6970610079632413138, 5220882309710198358,
    7452499364799151217, 5670684273436112453, 9192418593475606891,
    2710530330919684227, 9072091952411752914, 6360120677141533280,
    3506015481941078181, 5063211441721106581, 5476947082602793287,
    6460018848615869242, 8996347113218762168, 4941826540219699814,
    5340012941719518722, 8515364764212197415, 3620324317760888874,
    545718289421230192,  6713565938183566295, 8749671797245671699,
    7886379437883983778, 2850606819799227079, 4140685519357554153,
    5351351715882768430, 161442492401647628,  1767386671460012153,
    3623148448459659577, 8349872063292983030, 7920719083607917084,
    63819908448172125,   7324079424666381391, 6974459947935475142,
    4460259287421236283, 2720107701968170809, 1412207414884288846,
    2436781130816020512, 1420888948292116442, 4260045748799285417,
    4658659077932967386, 4210225877426452959, 4868724067688427743,
    3211838719217684409, 5844115181254310759, 1879989151817026262,
    8126802191844648996, 2195577531251852171, 5220649269741560291,
    3853655685112640001, 4626432008341368554, 7277238251270031509,
    9203282438360620161, 7646260484620618402, 2345752000232451257,
    8421041607360724077, 4903718838979256256, 3865592091619504151,
    2585351950854127176, 1635815523576639790, 2789868921744959124,
    8931832060241934770, 5272156422160459582, 5350995204599095710,
    7272267667406277809, 1697120182701059079, 8134316950160056840,
    7897706081904303083, 7709795420477875787, 6402140204428739278,
    959421351797076139,  328778351456995075,  7601341230416589406,
    6049720584736180755, 6848905875603639688, 8789266167579281559,
    817030001023789927,  8518207836433277306, 8957541815694527771,
    5694125177566246809, 5169428717284985696, 1794298857634677293,
    4770535440033167265, 7087215223264602643, 7265455071093474195,
    7689973497461431569, 6197423826123502829, 6574833498462852814,
    390606136857348436,  3207597178557492882, 6834395740056042652,
    8585806159956878780, 381324643828001159,  3294772391121354916,
    1153663688596238035, 8861883861209796104, 983688641821677196,
    4689516755469535122, 8433781647240225756, 4591980959835672202,
    6101047597777024846, 3053134209031798290, 1376863543734966191,
    5386939107640630502, 8266309491389127728, 3622184753035109514,
    4649345919927094816, 1487407507991268945, 1347956561393605212,
    948939898376635959,  697846364223041926,  1758622657800589937,
    5424231894423952804, 2777847639614510695, 9068435388553389326,
    987482232946500959,  1254868283406062377, 722299668574406839,
    7997713338328814988, 2671531369374583403, 1847743188380742938,
    5910585386297868341, 512807833622067859,  3137343605204552787,
    5145341114742721558, 1460587018164610578, 1219923676552498057,
    9194276799105293623, 2169841475447318893, 5982989868880019977,
    1158245138896319616, 8807466385347481891, 7040851959809265655,
    3033769248773152199, 6040048413421858664, 2140835145136463538,
    5113964547985007498, 4331903003613083548, 8036699607115402340,
    4252426294474967635, 2353066076199235983, 3855506397312979362,
    981062114859812291,  183117313156794109,  2685766852147415849,
    1059818803889023836, 2278409810617407735, 7648831837604969662,
    7410628218855945597, 8389628430102148374, 5722700081024673446,
    5847832245109094498, 335148720094992479,  5070379446783258152,
    698703942535988873,  4553457829088461088, 687556800758469492,
    3572107116053932424, 8867062726176084076, 3486836418852008044,
    2845905088346266504, 8207553275746646576, 8133885500687056574,
    8723401619504941501, 3852477666115442516, 965731291753144616,
    4287345499598857189, 8269200544141415489, 1486352473611756326,
    8269282372161376503, 5066620122461097704, 260142117193452043,
    8217951545929026532, 3930347356232302917, 3656294886515819053,
    4914353990220512663, 7433252748474059626, 6193629924436565400,
    4443152092433552818, 2365195740451848545, 370357915633334557,
    4194504443357946579, 1336048607779484455, 1372562060542626761,
    7359343756037546193, 3928352473583442675, 4069293005225840572,
    4426976481319831207, 2327007909742246410, 2758856538268489748,
    252987717580541136,  260083336607576298,  7588246916578300711,
    5513496912458202173, 719662317868983677,  3016847831890555050,
    4411455174667504626, 993342181615191877,  484603769038574023,
    1953449562731739688, 8096584173284004978, 7432252320911108358,
    4320065597887731914, 2350961699843379486, 136532993481113268,
    6811410358035406991, 1690877963569992588, 1250035756488744086,
    176520917624198020,  5507981012317408260, 1433439322293585770,
    9091549614292530551, 6684461953627602358, 8194799690097276912,
    6090163230092503544, 7423647742022966323, 7409844043785469852,
    837148947445313943,  2896360849191151304, 5738032690127080325,
    5929535114695802528, 5862222659445669882, 3065592381935983334,
    3307188256966176124, 4815672994556549355, 4320648740221605113,
    3087895188609642917, 639640983277614086,  7666924533543156092,
    6593174031833778472, 5743911189773520553, 4132655364739907970,
    6458475677223336525, 2813971850418759200, 7949188621558993047,
    1268998640806413460, 7632039666264774978, 2682741431573259740,
    6579215475576762119, 8071579422764824829, 8725255905854220024,
    4289793007419436269, 8085669211463816691, 1635613329524695424,
    5107569453262839511, 149887939837477810,  364016157578078987,
    2519840975368472922, 1272546346094633757, 5204091610965339093,
    5128754836814782846, 2489431260979009815, 7775199463866198334,
    7747025105179723318, 4613383425040780606, 7681476801447185451,
    4657953693893326676, 1547872822901077336, 363432742783615785,
    3214970439109986750, 6242060577695608818, 7398629954280920910,
    1654592962683211818, 1556016762969282503, 7774777018717604814,
    5213944129580576489, 5041770990240490156, 8138217821920442031,
    6165987744056711077, 5207856720539329367, 1451899167615806118,
    8710037842318201534, 2213518551333105352, 425280497253984357,
    1280658980579451554, 6174505957495871722, 8063517000203210821,
    6215526701920187663, 5797119583954460423, 7626549411438838365,
    1130817798875491613, 6986704928698825681, 3107636002991753921,
    573479364514425470,  3526169373741561399, 3409618899552166127,
    4594945175163324191, 376467615513564003,  5453644696149655505,
    2331133449657006680, 2322349138377707897, 6240295794518321220,
    5906089055588793194, 3592504980524234081, 3104744811704025344,
    909317986821894500,  1923027723164525609, 2396585049476457917,
    6210598929020949179, 27929070551661462,   1975657239256270592,
    4403430347936328479, 2956284144118008924, 5565389719225866902,
    6732760312960266851, 3424323390506343738, 8004281726550152631,
    2382839286780755543, 160197577161635876,  398386074157269940,
    6290860422713000051, 5973864358235042332, 6830056414628098092,
    5429167490928991501, 6842721113554109604, 6556559887527744560,
    7269066505304404715, 5239280218737534920, 2404564692486576880,
    2113736429681161138, 3834483527435933318, 4088517000184042549,
    5887437265732174785, 1331827351553341446, 400813928462103192,
    6027492016770027428, 2976784105935469475, 7046133448350222039,
    4310488406013251453, 2229793330735097564, 7727104003280382585,
    678057443262208664,  696111479990822363,  1674608947318634509,
    6905882621683594226, 8499712587748457227, 1448731391318949577,
    4044108763500890715, 6628127908023896630, 8528058375851471798,
    7749769847683738745, 3545821419138152637, 4141899912839147348,
    2674361490572258785, 487388530393985363,  7475848249716147467,
    5451782246163558181, 516885077658012988,  2355760341303580814,
    4830434816421069418, 4112739544946703160, 4213245476565143411,
    3478404708320550757, 3582340682144159039, 2627441235812654787,
    497719990830322604,  6488295538439191626, 6271906383443235780,
    5321039604098933530, 69556718724292564,   6422519394874873215,
    6971605569422082737, 9127416126334398339, 2881831216297372899,
    7764599234464239737, 8319321151614642954, 6369795913978062954,
    6432519942489401236, 7278609887091314654, 7992515641314821980,
    5831447761346508099, 850743685206533082,  8083502396250385994,
    4564597758616142938, 5975662057102720613, 2432200616480379511,
    2804057258156199737, 3910162648520117865, 3610501701571374215,
    3213195866694336825, 4217761374238904499, 8662858038299974787,
    2742764646771588239, 7941680422795680716, 9025954257936876298,
    4653284258534903725, 1763796310875700223, 1083084923609641470,
    1926656263672955922, 5728825142671657983, 7608920299746346956,
    170701016486928854,  6143797634184955659, 2364280739598827873,
    1048654234768565230, 7848118469513424864, 221255015351800211,
    7664436308256773150, 5673592913310242793, 3984187407248616507,
    8930334482161791560, 1372309850107200931, 6267649099491912709,
    932972762327133693,  5818224256322115458, 2357685280588096120,
    6082608045269724173, 4817019258698515648, 4943042034135670724,
    8571727569788614757, 9002340868753333582, 7174889172305921695,
    6274589175747554234, 1479987628470984469, 3939238313042556054,
    5911525889339812208, 3720408220047048866, 9122567394064341927,
    5878608889482349908, 7655966609147883168, 3719074426038901537,
    3169344491183461800, 3736845300891914578, 8109056352175853114,
    8494398548814276157, 8105600439965372887, 8717556480966140948,
    5556080275073625927, 539681935186087351,  1254042141091389953,
    8292434223081110046, 5354521240839722437, 8637254220910191218,
    474655631549538934,  667200525948806657,  746600167119858060,
    5204388113719275111, 6378380273910470568, 585373146005816685,
    1880360931843021697, 8503985322898863838, 7978042529293901442,
    5375676537932765785, 3717592657782424008, 1673936880091156497,
    5772237693582579735, 1415075995432857576, 8077470325194691411,
    2596331355632614504, 6944459805755557967, 2016457850001461214,
    6825948050288441063, 5855195787660691353, 2260478321719762738,
    2663567618585407530, 6001302034506443524, 1750262873453799642,
    3258856958531234665, 5344513049888178087, 5551529501535893317,
    163489460193126223,  420951351720731704,  3663337567631472233,
    1687324274998374708, 3702592986469817839, 7485161988252138643,
    4601999339326954467, 631539634866725998,  5533827843888400957,
    1373927473876988365, 5901790907574007318, 8842173864381210230,
    6939692750234453628, 3014376073925213034, 4687734476765133582,
    2886980638368163915, 8279136914788623716, 4529055111128030700,
    7014692591618803022, 8670668321622521429, 6100813244222789793,
    2285599359180989706, 6737851074687414493, 8618832706293770019,
    6592836153929544201, 3847587186418326698, 7902630532864676173,
    5033355258202347871, 5514357413163051730, 5612239725573938462,
    2667481185720171605, 2322956926477330650, 7751321299384310759,
    287755879843790778,  1180275274806735924, 1809310109227933335,
    5475403831828101089, 215810845349817119,  522406543681284986,
    4146731550307648851, 4601151044414344608, 7688985963763907128,
    7327558038122486669, 2346779220675780739, 743408870560835781,
    7802269849898206010, 959980685066279105,  7892392295840659680,
    8729232657528402928, 2408726477535394040, 8943395497314285961,
    1330917810517689929, 2530008862923191060, 7390810000761181192,
    7882694781156670939, 1691433236444331757, 3340675509224172929,
    4875896670317130747, 5552855747861865576, 905069322507976147,
    528481169254075903,  4600920900858556731, 4170582590968478172,
    4110285919830706798, 2972168123072990109, 7424007286622794863,
    6212639161752284802, 4336373776572978239, 8239597599029418590,
    2258700046046512537, 333599232454334285,  7853554901278982522,
    295955559060633383,  1342538090560686192, 2042136512795600204,
    5397282836253521709, 8862824728680822435, 2434604565443056375,
    8996264227410518137, 1124792438306022723, 2641253983155388112,
    536408289987634474,  9064389713745312233, 4842013530545804328,
    1425620385519653283, 3617176798697427822, 7481038621816316516,
    4682354157796451735, 4249703745851074427, 1976203270530278194,
    6253226634818227097, 5683007002923191683, 7688011428134125548,
    2499113281313730241, 5281475406258102354, 1795205692241093308,
    1275940323776950508, 976656569231422377,  7393493702163786919,
    933225011881264010,  5809528229116937836, 4507434675043175656,
    1687570279691012580, 6829921565735857193, 8358022948969077390,
    817377357507121087,  6188382252999346738, 5781989719656106874,
    5658887542578724387, 7035939817599073105, 4714212593926714393,
    8836867518814619074, 5269545752457896247, 5800126463305019126,
    6164724089370634318, 1596093288990732053, 2242534683871058847,
    8605806493136494998, 1174503227191808008, 2362249955446424309,
    5961691817260057007, 8400625589332830183, 3530383104989926911,
    5685818111563412931, 1753887697801296520, 463366229239939585,
    1910257746287125448, 4819129215788998894, 6191792168176596520,
    3689526633801812868, 4625274259150157533, 251026314848542486,
    2927964411157979723, 6763849625478207146, 4726083645534401597,
    3616165177898236397, 3127078183427730860, 8795115710158024862,
    9025208100743817205, 5457470415902927223, 7462799864111562176,
    39763910632590412,   8601454650183511845, 2634373774014945115,
    4951935725296907485, 996201251695640455,  559976856264369791,
    3171207045885281852, 1516293381485359265, 4480365878473919046,
    4300199256663180431, 2452728209028966306, 5463806115614619254,
    5555213285706858028, 456486498375163497,  7107742560553330087,
    1706600188803404938, 6383367504668254446, 5362315868356637102,
    7932269501432510913, 8288742252087101151, 5095512951200099322,
    2250548021853365643, 1541837741601447984, 396009332894686114,
    1857327428005031243, 1194840485019201589, 4594408441094763311,
    1947381606734177566, 3169825246098100557, 7362777620766552280,
    9020182159397366353, 8918644561792059717, 7086611520703977158,
    4073531996759699443, 2075202379353492510, 3481993164762994311,
    1970669624832596472, 5516615507526327517, 8694554547396848690,
    8892640680760390789, 8826172012862988972, 4933279965466353521,
    3056649322527268483, 3689644763299599850, 7649944024240765058,
    5390531026751112539, 524616799192156433,  8923061450104315514,
    7477407065889611815, 7042471528774850166, 4135125339368391381,
    5762366458697166101, 6647780452195219395, 23305844195085362,
    5238250486117618229, 4417684361164336932, 3375573721582726873,
    8151876134521979281, 633226309806228237,  1832900906880370799,
    6332281188373845115, 827040779023714886,  4494759774719856762,
    8661966933582724460, 3615800240324885672, 1900738379408956237,
    2604912778129824816, 4647833661977944164, 4243099979114787858,
    727579277828244643,  85668132088492141,   4853444987805699516,
    1875266539602626369, 489621703312480618,  5974508339801197590,
    8672576978102089842, 3154100766264807563, 6638449433883370026,
    1746881610772774381, 1255711820429588224, 7419585984017859836,
    1827510760930427803, 5401559779305475569, 7324368227724035936,
    5984938364290801833, 2397884492084734723, 5399335856245075257,
    8523472496541383989, 5248917011935144555, 861747227588415272,
    7814037936909642447, 6561739611654954560, 1455851518325522861,
    5741408923651499502, 5850818512269746059, 3581716379212382941,
    9133963967023877219, 4482512616534064784, 2672174789503893320,
    4769728392998400210, 2654230768545556587, 8584707443729324956,
    4080104597942955785, 8525601544389350832,
};

inline uint64_t get(int row, int col, gotypes::Player player) {
    return _zob[(row * 19 + col) * 2 +
                (player == gotypes::Player::black ? 0 : 1)];
}

constexpr std::uint64_t EMPTY_BOARD = 0;

}  // namespace zobrist
#endif  //DLGO_ZOBRIST_H